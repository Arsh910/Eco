version: 0.1

endpoints:
  - name: "REST API"
    port: 8000
    type: REST
    networkVisibility: Public
    context: /
    environment:
      # Suppress VEX notices for vulnerabilities that are not applicable
      TRIVY_DISABLE_VEX_NOTICE: "true"

      # Disable debug mode in production for security
      DEBUG: "false"

      # Specify the allowed hosts securely (do not use '*' in production)
      ALLOWED_HOSTS: "yourdomain.com"

      DJANGO_SETTINGS_MODULE: "backend.settings"
      PYTHONUNBUFFERED: "1"

    security:
      - type: apiKey
        name: x-api-key
      - type: oauth2
        name: oauth2

    description: >
      REST API that provides access to resources. Ensure to authenticate using the provided API key or OAuth2.

    deployment:
      runtime: python3.11
      image: python:3.11-slim
      resources:
        cpu: 0.5
        memory: 512Mi

    lifecycle:
      hooks:
        postStart:
          exec:
            command:
              - python
              - manage.py
              - migrate

    healthChecks:  # Optional: Consider adding health checks
      livenessProbe:
        exec:
          command:
            - curl
            - -f
            - http://localhost:8000/health
        initialDelaySeconds: 10
        periodSeconds: 30
      readinessProbe:
        exec:
          command:
            - curl
            - -f
            - http://localhost:8000/health
        initialDelaySeconds: 5
        periodSeconds: 10

