version: 0.1

endpoints:
  - name: "REST API"
    port: 8000
    type: REST
    networkVisibility: Public
    context: /
    environment:
      # Suppress VEX notices for vulnerabilities that are not applicable
      TRIVY_DISABLE_VEX_NOTICE: "true"

      # Disable debug mode in production for security
      DEBUG: "false"

      # Set allowed hosts, adjust as per your domain setup
      ALLOWED_HOSTS: "*"

      # Optional: Add other necessary environment variables
      DJANGO_SETTINGS_MODULE: "backend.settings"
      PYTHONUNBUFFERED: "1"

    security:
      - type: apiKey  # API key-based authentication
        name: x-api-key
      - type: oauth2  # OAuth2 authentication, if needed
        name: oauth2

    description: >
      REST API that provides access to resources. Ensure to authenticate using the provided API key or OAuth2.

    deployment:
      runtime: python3.11  # Specify the runtime to ensure Python is used
      image: python:3.11-slim  # Use a Python-specific image to avoid Go-related issues

    resources:
      cpu: 0.5  # Set CPU and memory limits as per your application needs
      memory: 512Mi

    lifecycle:
      hooks:
        postStart:
          exec:
            command:
              - python
              - manage.py
              - migrate  # Run migrations after the container starts
